# features/step_definitions/dashboard_steps.rb

Given('a user exists with email {string} and password {string}') do |email, password|
  @user = User.create!(
    name: "Test User",
    email: email,
    password: password
  )
end

Given('that user has the following events:') do |table|
  # table is a Cucumber::MultilineArgument::DataTable
  table.hashes.each do |row|
    @user.events.create!(
      event_name: row['event_name'],
      event_date: Date.parse(row['event_date']),
      budget: row['budget'],
      location: row['location'] # if you don't have location column, remove this
    )
  end
end

Given('I am logged in as {string} with password {string}') do |email, password|
  visit login_path
  fill_in 'Email', with: email
  fill_in 'Password', with: password
  click_button 'Log in'
end

When('I visit the dashboard') do
  visit dashboard_path
end

Then('I should see {string} within the upcoming events section') do |event_name|
  within('section', text: 'Upcoming Events') do
    expect(page).to have_content(event_name)
  end
end

Then('I should not see {string} within the upcoming events section') do |event_name|
  within('section', text: 'Upcoming Events') do
    expect(page).not_to have_content(event_name)
  end
end

When('I click on the event {string} in the upcoming events section') do |event_name|
  within('section', text: 'Upcoming Events') do
    click_link(event_name)
  end
end

Then('I should be on the event details page for {string}') do |event_name|
  event = Event.find_by!(event_name: event_name)
  expect(current_path).to eq(event_path(event))
end

Given('I am on the events index page') do
  visit events_path
end

When('I click "View all"') do
  click_link 'View all'
end

Then('I should be on the events index page') do
  expect(current_path).to eq(events_path)
end

When('I click on the event row for {string}') do |event_name|
  # Assuming each event is rendered as a link with the event name
  click_link event_name
end
