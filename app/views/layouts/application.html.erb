<!DOCTYPE html>
<html>
<head>
  <title>Giftwiseproject</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>

  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

  <%= javascript_importmap_tags %>
</head>


<body class="bg-[#f5f5fb] text-gray-900">
<%# show flash everywhere %>
  <div id="flash" data-turbo-cache="false">
    <% flash.each do |type, message| %>
      <% next if message.blank? %>

      <div
        class="flash-message fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg text-center text-sm font-medium
                   transition-all duration-700 ease-in-out
                   <%= %w[notice success].include?(type.to_s) ? "bg-green-100 border border-green-300 text-green-800" : "bg-red-100 border border-red-300 text-red-800" %>"
      >
        <%= message %>
      </div>
    <% end %>
  </div>

<%= javascript_tag do %>
  function dismissFlashes() {
  document.querySelectorAll(".flash-message").forEach((flash) => {
  setTimeout(() => flash.classList.add("opacity-0", "scale-90"), 2500);
  setTimeout(() => flash.remove(), 3500);
  });
  }

  document.addEventListener("turbo:load", dismissFlashes);
<% end %>

<%= render "shared/navbar" unless %w[sessions home].include?(controller_name) %>

<!-- Main page content -->
<div>
  <%= yield %>
</div>

<%= render "chatbots/widget" if user_signed_in? %>

<!-- Modal Blur Script MUST COME AFTER yield -->
<script>
    document.addEventListener("turbo:frame-load", function(event) {
        if (event.target.id === "modal") {
            const page = document.getElementById("page-wrapper");
            if (page) page.classList.add("blur-sm", "opacity-60", "transition");
        }
    });

    document.addEventListener("turbo:before-frame-render", function(event) {
        if (event.target.id === "modal") {
            const page = document.getElementById("page-wrapper");
            if (page) page.classList.remove("blur-sm", "opacity-60");
        }
    });
</script>
</body>
</html>