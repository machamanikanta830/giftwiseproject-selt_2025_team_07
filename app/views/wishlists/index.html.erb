<div class="min-h-screen bg-[#f5f5fb] text-gray-900">
  <header class="w-full bg-white shadow-sm">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-6 py-4">
      <%= link_to(current_user.present? ? dashboard_path : root_path,
                  class: "flex items-center gap-2 hover:opacity-90 transition") do %>
        <div class="w-9 h-9 rounded-2xl bg-[#f4e6ff] flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               class="w-6 h-6 text-[#a855f7]"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <rect x="3" y="8" width="18" height="13" rx="2" ry="2"></rect>
            <path d="M12 8v13"></path>
            <path d="M3 12h18"></path>
            <path d="M12 8h4a2 2 0 0 0 0-4c-3 0-4 4-4 4z"></path>
            <path d="M12 8H8a2 2 0 0 1 0-4c3 0 4 4 4 4z"></path>
          </svg>
        </div>
        <span class="text-xl font-semibold tracking-tight">GiftWise</span>
      <% end %>

      <nav class="flex items-center gap-4 text-sm font-medium">
        <span class="text-gray-700">
          Welcome, <%= current_user.name.presence || "there" %>!
        </span>

        <!-- Wishlist icon (active page) -->
        <%= link_to wishlists_path,
                    class: "w-9 h-9 rounded-full flex items-center justify-center bg-[#fee2e2] text-red-500 shadow-sm",
                    title: "Wishlist" do %>
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               class="w-5 h-5"
               fill="currentColor"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <path d="M20.8 5.5a5.5 5.5 0 0 0-7.8 0L12 6.5l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 21l7.8-6.7 1-1a5.5 5.5 0 0 0 0-7.8z"></path>
          </svg>
        <% end %>

        <div class="relative" data-controller="dropdown">
          <button
            type="button"
            data-action="click->dropdown#toggle"
            class="w-9 h-9 rounded-full bg-[#f4e6ff] flex items-center justify-center
             hover:bg-[#e9d5ff] transition shadow-sm"
          >
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 24 24"
                 class="w-5 h-5 text-[#a855f7]"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round">
              <circle cx="12" cy="8" r="3"></circle>
              <path d="M6 19c0-3 2.5-5 6-5s6 2 6 5"></path>
            </svg>
          </button>

          <div
            data-dropdown-target="menu"
            class="hidden absolute left-0 mt-3 w-64 origin-top-left rounded-2xl bg-white
         shadow-lg border border-gray-200 py-2 z-50"
          >
            <div class="px-4 pb-2 border-b border-gray-100 mb-2">
              <p class="text-sm font-semibold text-gray-900 truncate">
                <%= current_user.name %>
              </p>
              <% if current_user.respond_to?(:email) && current_user.email.present? %>
                <p class="text-xs text-gray-500 truncate">
                  <%= current_user.email %>
                </p>
              <% end %>
            </div>

            <%= link_to "Edit Profile",
                        edit_profile_path,
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 whitespace-nowrap" %>

            <%= link_to "Change password",
                        edit_password_path,
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 whitespace-nowrap" %>

            <div class="mt-2 pt-2 border-t border-gray-100">
              <%= button_to "Log Out",
                            logout_path,
                            method: :delete,
                            class: "w-full text-left px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 whitespace-nowrap" %>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 pt-10 pb-16">
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4">
        <%= link_to "← Back to Dashboard",
                    dashboard_path,
                    class: "inline-flex items-center px-4 py-2 rounded-full border border-gray-300 text-sm text-gray-700 hover:bg-gray-100" %>
        <h1 class="text-3xl font-semibold">Wishlist</h1>
      </div>
    </div>

    <% if @wishlist_items.any? %>
      <div class="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
        <% @wishlist_items.each do |idea| %>
          <div class="bg-white rounded-3xl shadow-sm border border-gray-200 overflow-hidden flex flex-col h-full">
            <% if idea.image_url.present? %>
              <img src="<%= idea.image_url %>"
                   alt="<%= idea.title %>"
                   class="w-full h-32 object-cover">
            <% end %>

            <div class="p-4 flex flex-col flex-1">
              <p class="text-xs text-gray-400 mb-1">
                <% if idea.event.present? %>
                  <%= idea.event.event_name %>
                <% end %>
                <% if idea.recipient.present? %>
                  • <%= idea.recipient.name %>
                <% end %>
              </p>

              <h2 class="font-semibold text-sm mb-1"><%= idea.title %></h2>

              <p class="text-xs text-gray-600 mb-2 flex-1">
                <%= truncate(idea.description.to_s, length: 120) %>
              </p>

              <p class="text-[11px] text-gray-500 leading-snug mb-3">
                <% if idea.category.present? %>
                  <strong>Category:</strong> <%= idea.category %><br>
                <% end %>
                <% if idea.estimated_price.present? %>
                  <strong>Est. price:</strong> <%= idea.estimated_price %><br>
                <% end %>
              </p>

              <div class="flex items-center justify-between mt-auto">
                <%= link_to "View event",
                            event_path(idea.event, from: "wishlist"),
                            class: "text-xs font-medium text-[#a855f7] hover:text-[#9333ea]" %>

                <%= button_to toggle_wishlist_event_ai_gift_suggestion_path(idea.event, idea),
                              method: :post,
                              params: { from: "wishlist" },
                              class: "inline-flex items-center gap-1 text-xs text-red-500 hover:text-red-600",
                              form: { data: { turbo: "false" } } do %>
                  <svg xmlns="http://www.w3.org/2000/svg"
                       viewBox="0 0 24 24"
                       class="w-4 h-4"
                       fill="currentColor"
                       stroke="currentColor"
                       stroke-width="2"
                       stroke-linecap="round"
                       stroke-linejoin="round">
                    <path d="M20.8 5.5a5.5 5.5 0 0 0-7.8 0L12 6.5l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 21l7.8-6.7 1-1a5.5 5.5 0 0 0 0-7.8z"></path>
                  </svg>
                  <span>Remove</span>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="bg-white rounded-3xl border border-dashed border-gray-300 px-6 py-10 text-center">
        <p class="text-sm text-gray-500 mb-2">
          Your wishlist is empty.
        </p>
        <p class="text-xs text-gray-400">
          Browse AI gift ideas for an event and tap the heart icon to save items here.
        </p>
      </div>
    <% end %>
  </main>
</div>
