<div class="min-h-screen bg-[#f5f5fb]">

  <header class="w-full bg-white shadow-sm">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-6 py-4">
      <%= link_to(current_user.present? ? dashboard_path : root_path,
                  class: "flex items-center gap-2 hover:opacity-90 transition") do %>
        <div class="w-9 h-9 rounded-2xl bg-[#f4e6ff] flex items-center justify-center">

          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               class="w-6 h-6 text-[#a855f7]"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <rect x="3" y="8" width="18" height="13" rx="2" ry="2"></rect>
            <path d="M12 8v13"></path>
            <path d="M3 12h18"></path>
            <path d="M12 8h4a2 2 0 0 0 0-4c-3 0-4 4-4 4z"></path>
            <path d="M12 8H8a2 2 0 0 1 0-4c3 0 4 4 4 4z"></path>
          </svg>
        </div>
        <span class="text-xl font-semibold tracking-tight">GiftWise</span>
      <% end %>


      <nav class="flex items-center gap-4 text-sm font-medium">

        <div class="relative" data-controller="dropdown">

          <button
            type="button"
            data-action="click->dropdown#toggle"
            class="w-9 h-9 rounded-full bg-[#f4e6ff] flex items-center justify-center
                   hover:bg-[#e9d5ff] transition shadow-sm"
          >
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 24 24"
                 class="w-5 h-5 text-[#a855f7]"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round">
              <circle cx="12" cy="8" r="3"></circle>
              <path d="M6 19c0-3 2.5-5 6-5s6 2 6 5"></path>
            </svg>
          </button>

          <div
            data-dropdown-target="menu"
            class="hidden absolute left-0 mt-3 w-64 origin-top-left rounded-2xl bg-white
                   shadow-lg border border-gray-200 py-2 z-50"
          >
            <div class="px-4 pb-2 border-b border-gray-100 mb-2">
              <p class="text-sm font-semibold text-gray-900 truncate">
                <%= current_user.name %>
              </p>
              <% if current_user.respond_to?(:email) && current_user.email.present? %>
                <p class="text-xs text-gray-500 truncate">
                  <%= current_user.email %>
                </p>
              <% end %>
            </div>

            <%= link_to "Edit Profile",
                        edit_profile_path,
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 whitespace-nowrap" %>

            <%= link_to "Change password",
                        edit_password_path,
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 whitespace-nowrap" %>

            <div class="mt-2 pt-2 border-t border-gray-100">
              <%= button_to "Log Out",
                            logout_path,
                            method: :delete,
                            class: "w-full text-left px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 whitespace-nowrap" %>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="max-w-4xl mx-auto px-6 py-12">

    <%= link_to recipients_path,
                class: "inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6" do %>
      <svg xmlns="http://www.w3.org/2000/svg"
           class="w-5 h-5"
           viewBox="0 0 24 24"
           fill="none"
           stroke="currentColor"
           stroke-width="2"
           stroke-linecap="round"
           stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Back to Recipients
    <% end %>

    <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-200">

      <div class="flex items-start justify-between mb-6">
        <div>
          <h1 class="text-3xl font-bold mb-2"><%= @recipient.name %></h1>

          <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600">
            <% if @recipient.relationship.present? %>
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24"
                     class="w-4 h-4"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                </svg>
                <%= @recipient.relationship %>
              </span>
            <% end %>

            <% if @recipient.age.present? %>
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24"
                     class="w-4 h-4"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                Age: <%= @recipient.age %>
              </span>
            <% end %>

            <% if @recipient.email.present? %>
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24"
                     class="w-4 h-4"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                  <rect x="3" y="5" width="18" height="14" rx="2" ry="2"></rect>
                  <polyline points="3 7 12 13 21 7"></polyline>
                </svg>
                <%= @recipient.email %>
              </span>
            <% end %>

            <% if @recipient.budget.present? %>
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24"
                     class="w-4 h-4"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                $<%= @recipient.budget %>
              </span>
            <% end %>
          </div>
        </div>

        <div class="flex gap-2">
          <%= link_to "Edit Recipient",
                      edit_recipient_path(@recipient),
                      class: "px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-sm font-medium transition" %>

          <%= button_to recipient_path(@recipient),
                        method: :delete,
                        form: { data: { turbo_confirm: "Remove this recipient?" } },
                        class: "px-4 py-2 rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-sm font-medium transition" do %>
            Remove
          <% end %>
        </div>
      </div>

      <div class="mb-6 pb-6 border-b border-gray-200">
        <h3 class="text-sm font-semibold text-gray-700 mb-4">Basic Info</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
          <div>
            <p class="text-gray-500 font-medium mb-1">Name</p>
            <p class="text-gray-900"><%= @recipient.name %></p>
          </div>

          <div>
            <p class="text-gray-500 font-medium mb-1">Email</p>
            <p class="text-gray-900"><%= @recipient.email.presence || "—" %></p>
          </div>

          <div>
            <p class="text-gray-500 font-medium mb-1">Relationship</p>
            <p class="text-gray-900"><%= @recipient.relationship.presence || "—" %></p>
          </div>

          <div>
            <p class="text-gray-500 font-medium mb-1">Age</p>
            <p class="text-gray-900"><%= @recipient.age.present? ? @recipient.age : "—" %></p>
          </div>

          <div>
            <p class="text-gray-500 font-medium mb-1">Gender</p>
            <p class="text-gray-900"><%= @recipient.gender.presence || "—" %></p>
          </div>

          <div>
            <p class="text-gray-500 font-medium mb-1">Occupation</p>
            <p class="text-gray-900"><%= @recipient.occupation.presence || "—" %></p>
          </div>

          <div>
            <p class="text-gray-500 font-medium mb-1">Budget</p>
            <p class="text-gray-900">
              <% if @recipient.budget.present? %>
                $<%= @recipient.budget %>
              <% else %>
                —
              <% end %>
            </p>
          </div>
        </div>
      </div>

      <div class="space-y-6 text-sm">
        <div>
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Bio</h3>
          <p class="text-gray-900 whitespace-pre-line">
            <%= @recipient.bio.presence || "—" %>
          </p>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Hobbies</h3>
          <p class="text-gray-900 whitespace-pre-line">
            <%= @recipient.hobbies.presence || "—" %>
          </p>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Likes</h3>
          <p class="text-gray-900 whitespace-pre-line">
            <%= @recipient.likes.presence || "—" %>
          </p>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Favorite Categories</h3>
          <p class="text-gray-900 whitespace-pre-line">
            <%= @recipient.favorite_categories.presence || "—" %>
          </p>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Dislikes</h3>
          <p class="text-gray-900 whitespace-pre-line">
            <%= @recipient.dislikes.presence || "—" %>
          </p>
        </div>

        <!-- Gift Ideas Section -->
        <div class="mt-10">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Gift Ideas</h3>
          <% @gift_ideas.each do |idea| %>
            <turbo-frame id="gift_idea_<%= idea.id %>">
              <div class="flex items-center justify-between p-3 rounded-2xl bg-purple-50 border border-purple-200">

                <p class="text-sm font-semibold text-gray-900">
                  <%= idea.idea %>
                  <% if idea.event_recipient&.event&.event_name.present? %>
                    <span class="text-xs text-gray-600">( <%= idea.event_recipient.event.event_name %> )</span>
                  <% end %>
                </p>

                <%= button_to "Remove",
                              recipient_gift_idea_path(@recipient, idea),
                              method: :delete,
                              class: "text-xs font-medium text-red-600 hover:text-red-800" %>
              </div>
            </turbo-frame>
          <% end %>

        </div>

        <!-- Gift Given Section -->
        <div class="mt-10">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Gift Given</h3>


          <% @gift_given.each do |gift| %>
            <turbo-frame id="gift_given_<%= gift.id %>">
              <div class="flex items-center justify-between p-3 rounded-2xl bg-purple-50 border border-purple-200">

                <p class="text-sm font-semibold text-gray-900">
                  <%= gift.gift_name %>
                  <% if gift.event_name.present? %>
                    <span class="text-xs text-gray-600">( <%= gift.event_name %> )</span>
                  <% end %>
                </p>

                <%= button_to "Remove",
                              recipient_gift_given_backlog_path(@recipient, gift),
                              method: :delete,
                              class: "text-xs font-medium text-red-600 hover:text-red-800" %>
              </div>
            </turbo-frame>
          <% end %>

        </div>
      </div>
    </div>
  </div>
</div>
