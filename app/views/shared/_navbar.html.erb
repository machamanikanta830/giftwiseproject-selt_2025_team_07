<!-- app/views/shared/_navbar.html.erb -->

<header class="w-full bg-white shadow-sm">
  <div class="max-w-6xl mx-auto flex items-center justify-between px-6 py-4">

    <%= link_to(current_user.present? ? dashboard_path : root_path,
                class: "flex items-center gap-2 hover:opacity-90 transition") do %>
      <div class="w-9 h-9 rounded-2xl bg-[#f4e6ff] flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 24 24"
             class="w-6 h-6 text-[#a855f7]"
             fill="none"
             stroke="currentColor"
             stroke-width="2"
             stroke-linecap="round"
             stroke-linejoin="round">
          <rect x="3" y="8" width="18" height="13" rx="2" ry="2"></rect>
          <path d="M12 8v13"></path>
          <path d="M3 12h18"></path>
          <path d="M12 8h4a2 2 0 0 0 0-4c-3 0-4 4-4 4z"></path>
          <path d="M12 8H8a2 2 0 0 1 0-4c3 0 4 4 4 4z"></path>
        </svg>
      </div>
      <span class="text-xl font-semibold tracking-tight">GiftWise</span>
    <% end %>

    <% if user_signed_in? %>
      <nav class="flex items-center gap-4 text-sm font-medium">
        <span class="text-gray-700">
          Welcome, <%= current_user.name.presence || "there" %>!
        </span>

        <%= link_to ai_gift_library_path,
                    class: "inline-flex items-center justify-center px-4 py-2 rounded-full bg-[#a855f7] text-white text-sm font-medium hover:bg-[#9333ea] transition",
                    title: "AI Gift Library" do %>
          AI Library
        <% end %>

        <%= link_to wishlists_path,
                    class: "w-9 h-9 rounded-full flex items-center justify-center hover:bg-[#fee2e2] transition",
                    title: "Wishlist" do %>
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               class="w-5 h-5"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <path d="M20.8 5.5a5.5 5.5 0 0 0-7.8 0L12 6.5l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 21l7.8-6.7 1-1a5.5 5.5 0 0 0 0-7.8z"></path>
          </svg>
        <% end %>

        <!-- Collaboration Requests -->
        <%= link_to collaboration_requests_path,
                    class: "relative p-2 hover:bg-gray-100 rounded-full transition",
                    title: "Collaboration Requests" do %>
          <svg xmlns="http://www.w3.org/2000/svg"
               class="w-6 h-6 text-gray-700 hover:text-[#a855f7]"
               viewBox="0 0 24 24"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>

          <% if current_user.pending_collaboration_requests.any? %>
            <span class="absolute top-0 right-0 w-5 h-5 bg-[#a855f7] text-white text-xs rounded-full flex items-center justify-center font-bold">
              <%= current_user.pending_collaboration_requests.count %>
            </span>
          <% end %>
        <% end %>

        <!-- Friends -->
        <%= link_to friendships_path,
                    class: "relative p-2 hover:bg-gray-100 rounded-full transition",
                    title: "Friends" do %>
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               class="w-6 h-6 text-gray-700 hover:text-[#a855f7]"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <circle cx="12" cy="7" r="3"></circle>
            <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"></path>
            <line x1="5" y1="5" x2="5" y2="9"></line>
            <line x1="3" y1="7" x2="7" y2="7"></line>
          </svg>

          <% if current_user.pending_friend_requests.any? %>
            <span class="absolute top-0 right-0 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold">
              <%= current_user.pending_friend_requests.count %>
            </span>
          <% end %>
        <% end %>

        <!-- Cart -->
        <%= link_to cart_path,
                    class: "relative w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-100 transition",
                    title: "Cart" do %>
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               class="w-5 h-5"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.7 13.4a2 2 0 0 0 2 1.6h9.7a2 2 0 0 0 2-1.6L23 6H6"></path>
          </svg>

          <%= turbo_frame_tag "cart_badge" do %>
            <% cart_count = Cart.for(current_user).cart_items.count %>
            <% if cart_count.positive? %>
              <span class="absolute -top-1 -right-1 w-5 h-5 bg-[#a855f7] text-white text-[10px] rounded-full flex items-center justify-center font-bold">
                <%= cart_count %>
              </span>
            <% end %>
          <% end %>
        <% end %>

        <div class="h-6 w-px bg-gray-300"></div>

        <%= link_to "My Orders", orders_path,
                    class: "text-sm text-gray-700 hover:text-[#a855f7] font-medium transition" %>

        <%= link_to "Edit Profile", edit_profile_path,
                    class: "text-sm text-gray-700 hover:text-[#a855f7] font-medium transition" %>

        <%= link_to "Change Password", edit_password_path,
                    class: "text-sm text-gray-700 hover:text-[#a855f7] font-medium transition" %>

        <%= button_to "Log Out",
                      logout_path,
                      method: :delete,
                      data: { turbo_confirm: "Log out now?" },
                      class: "text-sm text-red-600 hover:text-red-700 font-medium transition",
                      form: { style: "display: inline;" } %>
      </nav>
    <% end %>

  </div>
</header>
