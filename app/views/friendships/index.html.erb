<!-- app/views/friendships/index.html.erb -->
<div class="min-h-screen bg-[#f5f5fb]">
  <!-- Header -->
  <header class="w-full bg-white shadow-sm">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-6 py-4">
      <%= link_to dashboard_path, class: "flex items-center gap-2 hover:opacity-90 transition" do %>
        <div class="w-9 h-9 rounded-2xl bg-[#f4e6ff] flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 text-[#a855f7]" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="8" width="18" height="13" rx="2" ry="2"></rect>
            <path d="M12 8v13"></path>
            <path d="M3 12h18"></path>
          </svg>
        </div>
        <span class="text-xl font-semibold tracking-tight">GiftWise</span>
      <% end %>
    </div>
  </header>

  <div class="max-w-6xl mx-auto px-6 py-8">
    <!-- Back Button -->
    <%= link_to dashboard_path, class: "inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Back to Dashboard
    <% end %>

    <!-- Flash Messages Container -->
    <div id="flash-messages"></div>

    <!-- Page Title -->
    <div class="mb-8">
      <h1 class="text-4xl font-semibold mb-2">Friends</h1>
      <p class="text-gray-600">Manage your friend connections</p>
    </div>

    <!-- Pending Friend Requests -->
    <% if @pending_requests.any? %>
      <section class="mb-8">
        <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-200">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-semibold">Pending Requests</h2>
              <p class="text-sm text-gray-600"><%= pluralize(@pending_requests.count, 'friend request') %> waiting</p>
            </div>
          </div>

          <div class="space-y-3">
            <% @pending_requests.each do |friendship| %>
              <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 rounded-full bg-[#f4e6ff] flex items-center justify-center">
                    <span class="font-semibold text-[#a855f7] text-lg"><%= friendship.user.name[0].upcase %></span>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900"><%= friendship.user.name %></p>
                    <p class="text-sm text-gray-500"><%= friendship.user.email %></p>
                  </div>
                </div>
                <div class="flex gap-2">
                  <%= button_to "Accept",
                                friendship_path(friendship, accept: true),
                                method: :patch,
                                class: "px-4 py-2 rounded-full bg-[#a855f7] text-white font-medium hover:bg-[#9333ea] transition" %>
                  <%= button_to "Reject",
                                friendship_path(friendship, reject: true),
                                method: :patch,
                                class: "px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </section>
    <% end %>

    <div class="grid md:grid-cols-2 gap-6">
      <!-- Your Friends -->
      <section>
        <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-200">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-semibold">Your Friends</h2>
              <p class="text-sm text-gray-600"><%= pluralize(@friends.count, 'friend') %></p>
            </div>
          </div>

          <div class="space-y-3 max-h-96 overflow-y-auto">
            <% if @friends.any? %>
              <% @friends.each do |friend| %>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl">
                  <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full bg-[#f4e6ff] flex items-center justify-center relative">
                      <span class="font-semibold text-[#a855f7] text-lg"><%= friend.name[0].upcase %></span>
                      <% if friend.online? %>
                        <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>
                      <% end %>
                    </div>
                    <div>
                      <p class="font-medium text-gray-900"><%= friend.name %></p>
                      <p class="text-sm text-gray-500">
                        <% if friend.online? %>
                          <span class="text-green-600">● Online</span>
                        <% else %>
                          Offline
                        <% end %>
                      </p>
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <%= link_to messages_path(friend_id: friend.id),
                                class: "p-2 rounded-full bg-[#a855f7] text-white hover:bg-[#9333ea] transition",
                                title: "Send Message" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                      </svg>
                    <% end %>
                    <%= button_to friendship_path(Friendship.find_by(user: current_user, friend: friend)),
                                  method: :delete,
                                  data: { turbo_confirm: "Are you sure you want to remove #{friend.name} as a friend?" },
                                  class: "p-2 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition",
                                  title: "Remove Friend" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% else %>
              <div class="text-center py-8">
                <div class="w-16 h-16 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                </div>
                <p class="text-gray-500 text-sm">No friends yet</p>
                <p class="text-gray-400 text-xs mt-1">Add friends from the list →</p>
              </div>
            <% end %>
          </div>
        </div>
      </section>

      <!-- Add Friends -->
      <section>
        <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-200">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-full bg-[#f4e6ff] flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#a855f7]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-semibold">Add Friends</h2>
              <p class="text-sm text-gray-600"><%= pluralize(@other_users.count, 'user') %> available</p>
            </div>
          </div>

          <div class="space-y-3 max-h-96 overflow-y-auto" id="other-users-list">
            <% if @other_users.any? %>
              <% @other_users.each do |user| %>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl" id="user_<%= user.id %>">
                  <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full bg-[#f4e6ff] flex items-center justify-center">
                      <span class="font-semibold text-[#a855f7] text-lg"><%= user.name[0].upcase %></span>
                    </div>
                    <div>
                      <p class="font-medium text-gray-900"><%= user.name %></p>
                      <p class="text-sm text-gray-500"><%= user.email %></p>
                    </div>
                  </div>
                  <%= button_to friendships_path(friend_id: user.id),
                                method: :post,
                                data: { turbo_stream: true },
                                class: "px-4 py-2 rounded-full bg-green-500 text-white font-medium hover:bg-green-600 transition flex items-center gap-2" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Friend
                  <% end %>
                </div>
              <% end %>
            <% else %>
              <div class="text-center py-8">
                <div class="w-16 h-16 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <line x1="20" y1="8" x2="20" y2="14"></line>
                    <line x1="23" y1="11" x2="17" y2="11"></line>
                  </svg>
                </div>
                <p class="text-gray-500 text-sm">No more users to add</p>
                <p class="text-gray-400 text-xs mt-1">You've sent requests to everyone!</p>
              </div>
            <% end %>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
