<div class="min-h-screen bg-[#f5f5fb]">
  <header class="w-full bg-white shadow-sm">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-6 py-4">
      <%= link_to(current_user.present? ? dashboard_path : root_path,
                  class: "flex items-center gap-2 hover:opacity-90 transition") do %>
        <div class="w-9 h-9 rounded-2xl bg-[#f4e6ff] flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               class="w-6 h-6 text-[#a855f7]"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <rect x="3" y="8" width="18" height="13" rx="2" ry="2"></rect>
            <path d="M12 8v13"></path>
            <path d="M3 12h18"></path>
            <path d="M12 8h4a2 2 0 0 0 0-4c-3 0-4 4-4 4z"></path>
            <path d="M12 8H8a2 2 0 0 1 0-4c3 0 4 4 4 4z"></path>
          </svg>
        </div>
        <span class="text-xl font-semibold tracking-tight">GiftWise</span>
      <% end %>

      <nav class="flex items-center gap-4 text-sm font-medium">

        <div class="relative" data-controller="dropdown">
          <button
            type="button"
            data-action="click->dropdown#toggle"
            class="w-9 h-9 rounded-full bg-[#f4e6ff] flex items-center justify-center
             hover:bg-[#e9d5ff] transition shadow-sm"
          >
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 24 24"
                 class="w-5 h-5 text-[#a855f7]"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round">
              <circle cx="12" cy="8" r="3"></circle>
              <path d="M6 19c0-3 2.5-5 6-5s6 2 6 5"></path>
            </svg>
          </button>

          <div
            data-dropdown-target="menu"
            class="hidden absolute left-0 mt-3 w-64 origin-top-left rounded-2xl bg-white
         shadow-lg border border-gray-200 py-2 z-50"
          >
            <div class="px-4 pb-2 border-b border-gray-100 mb-2">
              <p class="text-sm font-semibold text-gray-900 truncate">
                <%= current_user.name %>
              </p>
              <% if current_user.respond_to?(:email) && current_user.email.present? %>
                <p class="text-xs text-gray-500 truncate">
                  <%= current_user.email %>
                </p>
              <% end %>
            </div>

            <%= link_to "Edit Profile",
                        edit_profile_path,
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 whitespace-nowrap" %>

            <%= link_to "Change password",
                        edit_password_path,
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 whitespace-nowrap" %>

            <div class="mt-2 pt-2 border-t border-gray-100">
              <%= button_to "Log Out",
                            logout_path,
                            method: :delete,
                            class: "w-full text-left px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 whitespace-nowrap" %>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="max-w-4xl mx-auto px-6 py-12">
    <% back_path  = params[:from] == "dashboard" ? dashboard_path : events_path %>
    <% back_label = params[:from] == "dashboard" ? "Back to Dashboard" : "Back to Events" %>

    <%= link_to back_path,
                class: "inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      <%= back_label %>
    <% end %>

    <% if alert.present? %>
      <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-2xl mb-6">
        <%= alert %>
      </div>
    <% end %>

    <div class="bg-white rounded-3xl p-8 shadow-sm border border-gray-200">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h1 class="text-3xl font-bold mb-2"><%= @event.event_name %></h1>
          <div class="flex items-center gap-4 text-sm text-gray-600">
            <span class="flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <%= @event.event_date.strftime("%B %d, %Y") %>
            </span>

            <% if @event.location.present? %>
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <%= @event.location %>
              </span>
            <% end %>

            <% if @event.budget.present? %>
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                $<%= number_with_precision(@event.budget, precision: 2) %>
              </span>
            <% end %>
          </div>
        </div>

        <div class="flex gap-2">
          <%= link_to "Edit Event",
                      edit_event_path(@event),
                      class: "px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-sm font-medium transition" %>

          <%= button_to event_path(@event),
                        method: :delete,
                        data: { confirm: "Are you sure you want to delete this event?" },
                        class: "px-4 py-2 rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-sm font-medium transition" do %>
            Delete
          <% end %>
        </div>

      </div>

      <% if @event.description.present? %>
        <div class="mb-6 pb-6 border-b border-gray-200">
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Description</h3>
          <p class="text-gray-600"><%= @event.description %></p>
        </div>
      <% end %>

      <div class="mb-8">
        <h3 class="text-lg font-semibold mb-4">Current Recipients (<%= @event_recipients.count %>)</h3>
        <% if @event_recipients.any? %>
          <div class="space-y-3">
            <% @event_recipients.each do |event_recipient| %>
              <div class="flex items-center justify-between p-4 border border-gray-200 rounded-2xl bg-gray-50">
                <div>
                  <p class="font-medium"><%= event_recipient.recipient.name %></p>
                  <div class="flex items-center gap-3 text-sm text-gray-500 mt-1">
                    <% if event_recipient.recipient.relationship.present? %>
                      <span><%= event_recipient.recipient.relationship %></span>
                    <% end %>
                    <% if event_recipient.recipient.age.present? %>
                      <span>Age: <%= event_recipient.recipient.age %></span>
                    <% end %>
                  </div>
                </div>

                <%= button_to "Remove",
                              remove_recipient_event_path(@event, event_recipient_id: event_recipient.id),
                              method: :delete,
                              data: { confirm: "Remove #{event_recipient.recipient.name} from this event?" },
                              class: "px-4 py-2 rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-sm font-medium transition" %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-8 text-gray-500 border border-gray-200 rounded-2xl bg-gray-50">
            <p>No recipients added yet</p>
          </div>
        <% end %>
      </div>

      <div>
        <h3 class="text-lg font-semibold mb-4">Add Recipients (<%= @available_recipients.count %> available)</h3>
        <% if @available_recipients.any? %>
          <div class="space-y-3">
            <% @available_recipients.each do |recipient| %>
              <div class="flex items-center justify-between p-4 border border-gray-200 rounded-2xl hover:bg-gray-50 transition">
                <div>
                  <p class="font-medium"><%= recipient.name %></p>
                  <div class="flex items-center gap-3 text-sm text-gray-500 mt-1">
                    <% if recipient.relationship.present? %>
                      <span><%= recipient.relationship %></span>
                    <% end %>
                    <% if recipient.age.present? %>
                      <span>Age: <%= recipient.age %></span>
                    <% end %>
                  </div>
                  <% if recipient.likes.present? %>
                    <p class="text-xs text-gray-400 mt-1">Likes: <%= recipient.likes.truncate(50) %></p>
                  <% end %>
                </div>

                <%= button_to "Add to Event",
                              add_recipient_event_path(@event, recipient_id: recipient.id),
                              method: :post,
                              class: "px-4 py-2 rounded-full bg-[#a855f7] text-white text-sm font-medium hover:bg-[#9333ea] transition" %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-8 text-gray-500 border border-gray-200 rounded-2xl bg-gray-50">
            <% if @all_recipients.empty? %>
              <p class="mb-4">You haven't created any recipients yet.</p>
              <%= link_to "Create a Recipient", "#", class: "inline-block px-4 py-2 rounded-full bg-[#a855f7] text-white text-sm font-medium hover:bg-[#9333ea] transition" %>
            <% else %>
              <p>All your recipients have been added to this event!</p>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
